-- 호텔 예약 프로시저
create or replace PROCEDURE SP_HOTEL_RSRV 
(
  P_SR_ID IN INT,
  P_USER_ID IN VARCHAR2,
  P_TOTAL_PC IN INT,
  P_CHECK_IN_DT IN VARCHAR2,
  P_CHECK_OUT_DT IN VARCHAR2,
  P_SRL_NM IN VARCHAR2,
  P_SRL_EMAIL IN VARCHAR2,
  P_SRL_PHONE IN VARCHAR2,
  P_SRL_ADULT_PP IN INT,
  P_SRL_KID_PP IN INT,
  P_NUM IN VARCHAR2,
  P_PIN_NUM IN INT,
  P_YEAR IN INT,
  P_MONTH IN INT
) AS 
    V_PH_IDX INT;
BEGIN

    V_PH_IDX := PAYMENT_HIST_SEQ.NEXTVAL;

    -- 결제 로그 추가
    INSERT INTO PAYMENT_HIST VALUES (V_PH_IDX, P_USER_ID, '1', P_TOTAL_PC, SYSDATE);
    -- 카드 결제 로그 추가
    INSERT INTO CARD_PAYMENT_HIST VALUES (V_PH_IDX, P_NUM, P_PIN_NUM, P_YEAR, P_MONTH, 1);
    -- 예약 로그 추가
    INSERT INTO STAYING_RSRV_LOG (SR_ID, USER_ID, SRL_TOTAL_PC, SRL_CHECK_IN_DT, SRL_CHECK_OUT_DT, SRL_NM, SRL_EMAIL, SRL_PHONE, PH_IDX, SRL_ADULT_PP, SRL_KID_PP)
    VALUES (P_SR_ID, P_USER_ID, P_TOTAL_PC, P_CHECK_IN_DT, P_CHECK_OUT_DT, P_SRL_NM, P_SRL_EMAIL, P_SRL_PHONE, V_PH_IDX, P_SRL_ADULT_PP, P_SRL_KID_PP);

END SP_HOTEL_RSRV;